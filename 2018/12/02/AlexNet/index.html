<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Deep Learning,CNN," />










<meta name="description" content="AlexNet is introduced in the seminal paper ImageNet Classification with Deep Convolutional Neural Networks, which is a deep convolutional neural network and kicked ass on the ImageNet LSVRC-2010 conte">
<meta name="keywords" content="Deep Learning,CNN">
<meta property="og:type" content="article">
<meta property="og:title" content="AlexNet">
<meta property="og:url" content="http://yoursite.com/2018/12/02/AlexNet/index.html">
<meta property="og:site_name" content="Blog of Qing">
<meta property="og:description" content="AlexNet is introduced in the seminal paper ImageNet Classification with Deep Convolutional Neural Networks, which is a deep convolutional neural network and kicked ass on the ImageNet LSVRC-2010 conte">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/2018/12/02/AlexNet/AlexNet-1.png">
<meta property="og:updated_time" content="2019-02-18T20:09:31.854Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AlexNet">
<meta name="twitter:description" content="AlexNet is introduced in the seminal paper ImageNet Classification with Deep Convolutional Neural Networks, which is a deep convolutional neural network and kicked ass on the ImageNet LSVRC-2010 conte">
<meta name="twitter:image" content="http://yoursite.com/2018/12/02/AlexNet/AlexNet-1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/12/02/AlexNet/"/>





  <title>AlexNet | Blog of Qing</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Blog of Qing</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/02/AlexNet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qing Wong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Blog of Qing">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">AlexNet</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-02T12:25:44-06:00">
                2018-12-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Learning/" itemprop="url" rel="index">
                    <span itemprop="name">Deep Learning</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>AlexNet is introduced in the seminal paper <a href="https://papers.nips.cc/paper/4824-imagenet-classification-with-deep-convolutional-neural-networks.pdf" target="_blank" rel="noopener">ImageNet Classification with Deep Convolutional Neural Networks</a>, which is a deep convolutional neural network and kicked ass on the ImageNet LSVRC-2010 contest. AlexNet does a pretty good job classifying the 1.2 million high-resolution images into 1000 different classes. Actually, top-1 and top-5 error rate of 37.5% and 17.5% are achieved on the test data, which is way better than the previous state-of-the-art. In this article, I will introduce what AlexNet is, namely the network architecture, how they deal with overfitting, and evaluation results.</p>
<a id="more"></a>
<h1 id="The-Architecture"><a href="#The-Architecture" class="headerlink" title="The Architecture"></a>The Architecture</h1><p><img src="/2018/12/02/AlexNet/AlexNet-1.png" alt="lexNet-"></p>
<p>The <a href="https://www.learnopencv.com/understanding-alexnet/" target="_blank" rel="noopener">picture</a> above shows the architecture of AlexNet.We can eyeball the graph and find that AlexNet contains eight layers  —  five convolutional and three fully-connected layers. <a href="https://medium.com/coinmonks/paper-review-of-alexnet-caffenet-winner-in-ilsvrc-2012-image-classification-b93598314160" target="_blank" rel="noopener">ref</a> </p>
<p><strong>Input</strong>: $227 \times 227 \times 3$ images</p>
<p><strong>1st Convolutional Layers</strong>: 96 kernels with kernel size $11 \times 11$, strides=4, pad=0, activation=”relu”</p>
<p>$55 \times 55 \times 96$ feature maps</p>
<p>Then $3 \times 3$ <strong>Max Pooling</strong> (strides=2) </p>
<p>$27 \times 27 \times 96$ feature maps</p>
<blockquote>
<ol>
<li>Max Pooling layers are usually used to downsample the width and height of the tensors, keeping the depth same. </li>
<li>ReLU is chosen because of its non-saturating-nonlinearity peoperty, which is $f(x)=max(x,0)$, resulting in the benefits that deep convolutional neural networks with ReLUs train several times faster than their equivalents with tanh units.</li>
<li>Compared with the previous state-of-the-art, the overlapping pooling instead of nonoverlapping pooling is utilized, which helps improve the classification accuray.</li>
</ol>
</blockquote>
<p><strong>2nd Convolutional Layers</strong>: 256 kernels with kernel size $5 \times 5$, strides=1, pad=2, activation=”relu”</p>
<blockquote>
<p>pad=2 are used to keep output maps having smae size with input maps.</p>
</blockquote>
<p>$27 \times 27 \times 256$ feature maps</p>
<p>Then $3 \times 3$ <strong>Max Pooling</strong> (strides=2)</p>
<p>$13 \times 13 \times 256$ feature maps</p>
<p><strong>3rd Convolutional Layers</strong>: 384 kernels with kernel size $3 \times 3$, strides=1, pad=, activation=”relu”1</p>
<p>$13 \times 13 \times 384$ feature maps</p>
<p><strong>4th Convolutional Layers</strong>: 384 kernels with kernel size $3 \times 3$, strides=1, pad=1, activation=”relu”</p>
<p>$13 \times 13 \times 384$ feature maps</p>
<p><strong>5th Convolutional Layers</strong>: 256 kernels with kernel size $3 \times 3$, strides=1, pad=1, activation=”relu”</p>
<p>$13 \times 13 \times 384$ feature maps</p>
<p>Then $3 \times 3$ <strong>Max Pooling</strong> (strides=2)</p>
<p>$6 \times 6 \times 256$ feature maps</p>
<p><strong>6th Fully-Connected Layers</strong>: 4096 neurons, activation=’tanh’</p>
<p><strong>7th Fully-Connected Layers</strong>: 4096 neurons, activation=’tanh’</p>
<p><strong>8th Fully-Connected Layers</strong>: 1000 neurons (since there 1000 classes), activation=’softmax’</p>
<h1 id="Overfitting"><a href="#Overfitting" class="headerlink" title="Overfitting"></a>Overfitting</h1><p>The author also proposed several methods to attack the overfitting problem, i.e. data argmentation and dropout. </p>
<h2 id="Data-Argmentation"><a href="#Data-Argmentation" class="headerlink" title="Data Argmentation"></a>Data Argmentation</h2><p>The easiest and most common way to reduce overfitting on image data is to artificially enlarge the dataset using label-preserving transformations. The authors employ two distinct forms of data augmentation.</p>
<p>The first form is to generated cropped images and horizontal reflections. For each training image of size $256 \times 256$, multiple patches of size $227 \times 227$ are extracted. Then, we can get 841$227 \times 227$ patches from a single image ($(256-227) \times (256-227)=841$). And for each patch we take a horizontal reflection, resulting in increasing the size of training set by a factor of 1682. <a href="https://stats.stackexchange.com/questions/178184/data-augmentation-step-in-krizhevsky-et-al-paper" target="_blank" rel="noopener">ref</a> </p>
<p>The second form consists of altering the intensities of the RGB channels in training set, which is performed by PCA.</p>
<h2 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h2><h1 id="Training-Details"><a href="#Training-Details" class="headerlink" title="Training Details"></a>Training Details</h1><p>Stochastic Gradient Descent is harnessed to train the model with a batch size of 128 images, momentum of 0.9, and weight decay of 0.0005. </p>
<p>The weights in each layer are initialized from a zero-mean Gaussian distribution with standard deviation 0.01. We initialized the neuron biases in the second, fourth, and fifth convolutional layers, as well as in the fully-connected hidden layers, with the constant 1. This initialization accelerates the early stages of learning by providing the ReLUs with positive inputs. We initialized the neuron biases in the remaining layers with the constant 0.</p>
<p>All layers use the same learning rate, which is adjusted manually throughout training. The heuristic is to divide the learning rate by 10 when the validation error rate stopped improving with the current learning rate. The learning rate is initialized at 0.01 and reduced three times prior to termination.</p>
<h1 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h1><h1 id="Pythpn-Implementation"><a href="#Pythpn-Implementation" class="headerlink" title="Pythpn Implementation"></a>Pythpn Implementation</h1><p>Alright, let’s write a program that learns how to recognize images using cifar10 dataset. We’ll do this with a short keras program. </p>
<p>Let me explain the dataset cifar10 firstly before going to the architecture implementation. Instead of all images, we just use two categories, i.e. cat and dog. <a href="https://www.kaggle.com/c/dogs-vs-cats/data" target="_blank" rel="noopener">Dog vs Cat</a> consists of 12500 training cat images and 12500 training dog images. We are going to use 1000 cat images and 1000 dog images as training dataset while 400 cat images and 400 dog images as testing datasets. Here’s the code we use to organize the training and test datasets.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
<div class="line">21</div>
<div class="line">22</div>
<div class="line">23</div>
<div class="line">24</div>
<div class="line">25</div>
<div class="line">26</div>
<div class="line">27</div>
<div class="line">28</div>
<div class="line">29</div>
<div class="line">30</div>
<div class="line">31</div>
<div class="line">32</div>
</pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div>
<div class="line"><span class="keyword">import</span> cv2</div>
<div class="line"></div>
<div class="line">inpath = <span class="string">"/Users/daniel/Documents/all/train/"</span></div>
<div class="line"></div>
<div class="line">outcatTra = <span class="string">"/Users/daniel/Documents/all/Training/cats/"</span></div>
<div class="line"></div>
<div class="line">outdogTra = <span class="string">"/Users/daniel/Documents/all/Training/dogs/"</span></div>
<div class="line"></div>
<div class="line">outcatTest = <span class="string">"/Users/daniel/Documents/all/Testing/cats/"</span></div>
<div class="line"></div>
<div class="line">outdogTest = <span class="string">"/Users/daniel/Documents/all/Testing/dogs/"</span></div>
<div class="line"></div>
<div class="line">os.makedirs(outcatTra,exist_ok=<span class="keyword">True</span>)</div>
<div class="line">os.makedirs(outdogTra,exist_ok=<span class="keyword">True</span>)</div>
<div class="line">os.makedirs(outcatTest,exist_ok=<span class="keyword">True</span>)</div>
<div class="line">os.makedirs(outdogTest,exist_ok=<span class="keyword">True</span>)</div>
<div class="line"></div>
<div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</div>
<div class="line">    cat = cv2.imread(inpath+<span class="string">"cat.%d.jpg"</span>%i)</div>
<div class="line">    dog = cv2.imread(inpath+<span class="string">"dog.%d.jpg"</span>%i)</div>
<div class="line"></div>
<div class="line">    cv2.imwrite(outcatTra+<span class="string">"cat.%d.jpg"</span>%i,cat)</div>
<div class="line">    cv2.imwrite(outdogTra+<span class="string">"dog.%d.jpg"</span>%i,dog)</div>
<div class="line"></div>
<div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">400</span>):</div>
<div class="line">    j = <span class="number">4000</span>+i</div>
<div class="line">    cat = cv2.imread(inpath + <span class="string">"cat.%d.jpg"</span> % j)</div>
<div class="line">    dog = cv2.imread(inpath + <span class="string">"dog.%d.jpg"</span> % j)</div>
<div class="line"></div>
<div class="line">    cv2.imwrite(outcatTest + <span class="string">"cat.%d.jpg"</span> % i, cat)</div>
<div class="line">    cv2.imwrite(outdogTest + <span class="string">"dog.%d.jpg"</span> % i, dog)</div>
</pre></td></tr></table></figure>
<p>After running the codes, we will have the dataset organization like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
<div class="line">21</div>
<div class="line">22</div>
<div class="line">23</div>
<div class="line">24</div>
<div class="line">25</div>
<div class="line">26</div>
<div class="line">27</div>
<div class="line">28</div>
<div class="line">29</div>
<div class="line">30</div>
<div class="line">31</div>
</pre></td><td class="code"><pre><div class="line">Data/</div>
<div class="line">    Training/</div>
<div class="line">            cats/</div>
<div class="line">                cat.0.jpg</div>
<div class="line">                cat.1.jpg</div>
<div class="line">                .</div>
<div class="line">                .</div>
<div class="line">                .</div>
<div class="line">                cat.999.jpg</div>
<div class="line">            dogs/</div>
<div class="line">                dog.0.jpg</div>
<div class="line">                dog.1.jpg</div>
<div class="line">                .</div>
<div class="line">                .</div>
<div class="line">                .</div>
<div class="line">                dog.999.jpg</div>
<div class="line">    Testing/</div>
<div class="line">           cats/</div>
<div class="line">               cat.0.jpg</div>
<div class="line">               cat.1.jpg</div>
<div class="line">               .</div>
<div class="line">               .</div>
<div class="line">               .</div>
<div class="line">               cat.399.jpg</div>
<div class="line">           dogs/</div>
<div class="line">               dog.0.jpg</div>
<div class="line">               dog.1.jpg</div>
<div class="line">               .</div>
<div class="line">               .</div>
<div class="line">               .</div>
<div class="line">               dog.399.jpg</div>
</pre></td></tr></table></figure>
<p>Then, I am going to introduce <code>ImageDataGenerator</code>, which is employed to argument dataset.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
<div class="line">21</div>
<div class="line">22</div>
<div class="line">23</div>
<div class="line">24</div>
<div class="line">25</div>
<div class="line">26</div>
<div class="line">27</div>
<div class="line">28</div>
<div class="line">29</div>
<div class="line">30</div>
</pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</div>
<div class="line"></div>
<div class="line"><span class="comment"># https://blog.csdn.net/jacke121/article/details/79245732</span></div>
<div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataLoader</span><span class="params">()</span>:</span></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,img_res=<span class="params">(<span class="number">227</span>, <span class="number">227</span>)</span>)</span>:</span></div>
<div class="line">        self.img_res = img_res</div>
<div class="line"></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_batch</span><span class="params">(self,batch_size)</span>:</span></div>
<div class="line">        train_datagen = ImageDataGenerator(</div>
<div class="line">            shear_range= <span class="number">0.2</span>,</div>
<div class="line">            zoom_range= <span class="number">0.2</span>,</div>
<div class="line">            horizontal_flip=<span class="keyword">True</span></div>
<div class="line">        )</div>
<div class="line">        test_datagen = ImageDataGenerator()</div>
<div class="line">        train_generator = train_datagen.flow_from_directory(</div>
<div class="line">            <span class="string">'./dataset_path/'</span>,</div>
<div class="line">            batch_size=batch_size,</div>
<div class="line">            shuffle=<span class="keyword">True</span>,</div>
<div class="line">            target_size=self.img_res,</div>
<div class="line">            class_mode=<span class="string">'categorical'</span></div>
<div class="line">        )</div>
<div class="line">        validation_generator = test_datagen.flow_from_directory(</div>
<div class="line">            <span class="string">'./dataset_path/'</span>,</div>
<div class="line">            batch_size=batch_size,</div>
<div class="line">            target_size=self.img_res,</div>
<div class="line">            shuffle=<span class="keyword">True</span>,</div>
<div class="line">            class_mode=<span class="string">'categorical'</span></div>
<div class="line">        )</div>
<div class="line"></div>
<div class="line">        <span class="keyword">return</span> train_generator,validation_generator</div>
</pre></td></tr></table></figure>
<p><code>img_size</code> is used to resize all the input image so that they have the same width and height. Then we create an <code>ImageDataGenerator</code> instance with specified parameters, where:</p>
<ul>
<li>shear_range is used to sheer images and its value is shear angle in counter-clockwise direction in degrees. </li>
<li>zoom_range is is used for image zoom and a value greater than 1 corresponds to image amplification otherwise image reduction.</li>
<li>horizontal_flip is used to flip inputs horizontally.</li>
</ul>
<p>Then we create a data generator by using the instance above. Note that we should explicitly point out the dataset directory, which contain one subdirectory per class. Here we generate <code>train_generator</code> and <code>validation_generator</code>. </p>
<p>Let me explain the core features of the AlexNet code, before giving a full listing. The centerpiece is a <code>AlexNet</code> class, which we use to represent a <code>AlexNet</code>. Here is the code we use to initialize a <code>AlexNet</code> object.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
</pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> layers</div>
<div class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</div>
<div class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</div>
<div class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> Adam</div>
<div class="line"><span class="keyword">from</span> data_load <span class="keyword">import</span> DataLoader</div>
<div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlexNet</span><span class="params">()</span>:</span></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div>
<div class="line">        self.height = <span class="number">227</span></div>
<div class="line">        self.width = <span class="number">227</span></div>
<div class="line">        self.channels = <span class="number">3</span></div>
<div class="line">        self.img_shape = (self.height,self.width,self.channels)</div>
<div class="line">        self.nb_classes = <span class="number">2</span></div>
<div class="line">        self.mean_flag = <span class="keyword">False</span></div>
<div class="line">        self.data_loader = DataLoader(img_res=(self.height, self.width))</div>
<div class="line">        optimizer = Adam()</div>
<div class="line"></div>
<div class="line">        self.alexnet = self.make_model()</div>
<div class="line">        self.alexnet.compile(loss=<span class="string">'categorical_crossentropy'</span>,</div>
<div class="line">                             optimizer=optimizer,</div>
<div class="line">                             metrics=[<span class="string">'accuracy'</span>])</div>
</pre></td></tr></table></figure>
<p>In this code, we make all images share the same height and weight, i.e., 227, and the input images are three channels. Since we only have two categories, so <code>nb_classes=2</code>. Then we create a data loader class. By <code>self.alexnet = self.make_model()</code>, we build a AlexNet and in order to train the network, we use <code>categorical_crossentropy</code> as loss and use Adam to optimize the network. Here is the code for <code>make_model</code> method:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
<div class="line">21</div>
<div class="line">22</div>
<div class="line">23</div>
<div class="line">24</div>
<div class="line">25</div>
<div class="line">26</div>
<div class="line">27</div>
<div class="line">28</div>
<div class="line">29</div>
</pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(self)</span>:</span></div>
<div class="line">        input = layers.Input(shape=self.img_shape)</div>
<div class="line">        <span class="keyword">if</span> self.mean_flag:</div>
<div class="line">            <span class="keyword">pass</span></div>
<div class="line">        x = layers.Conv2D(<span class="number">96</span>,kernel_size=<span class="number">11</span>,strides=<span class="number">4</span>,activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(input)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>,<span class="number">3</span>),strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">256</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>), strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">384</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.Conv2D(<span class="number">384</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">256</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>), strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Flatten()(x)</div>
<div class="line">        x = layers.Dense(<span class="number">4096</span>,activation=<span class="string">'tanh'</span>)(x)</div>
<div class="line">        x = layers.Dropout(<span class="number">0.5</span>)(x)</div>
<div class="line">        x = layers.Dense(<span class="number">4096</span>,activation=<span class="string">'tanh'</span>)(x)</div>
<div class="line">        x = layers.Dropout(<span class="number">0.5</span>)(x)</div>
<div class="line">        output = layers.Dense(self.nb_classes,activation=<span class="string">'softmax'</span>)(x)</div>
<div class="line"></div>
<div class="line">        model = Model(input,output)</div>
<div class="line">        model.summary()</div>
<div class="line">        <span class="keyword">return</span> model</div>
</pre></td></tr></table></figure>
<p>Basically, the codes correspond to the network architecture we talk about above.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
</pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self,epochs,batch_size=<span class="number">16</span>)</span>:</span></div>
<div class="line">    train_generator, validation_generator = self.data_loader.load_batch(batch_size)</div>
<div class="line"></div>
<div class="line">    self.alexnet.fit_generator(train_generator,</div>
<div class="line">                               steps_per_epoch=<span class="number">100</span>,</div>
<div class="line">                               epochs=epochs,</div>
<div class="line">                               validation_data=validation_generator,</div>
<div class="line">                               validation_steps=<span class="number">20</span>,</div>
<div class="line">                               verbose=<span class="number">1</span>)</div>
</pre></td></tr></table></figure>
<p>Here, we train the model <code>epochs</code> times and <code>sample_per_epoch</code> is batches of training samples;  <code>validation_steps</code> is batches of validation samples.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div>
<div class="line">2</div>
<div class="line">3</div>
<div class="line">4</div>
<div class="line">5</div>
<div class="line">6</div>
<div class="line">7</div>
<div class="line">8</div>
<div class="line">9</div>
<div class="line">10</div>
<div class="line">11</div>
<div class="line">12</div>
<div class="line">13</div>
<div class="line">14</div>
<div class="line">15</div>
<div class="line">16</div>
<div class="line">17</div>
<div class="line">18</div>
<div class="line">19</div>
<div class="line">20</div>
<div class="line">21</div>
<div class="line">22</div>
<div class="line">23</div>
<div class="line">24</div>
<div class="line">25</div>
<div class="line">26</div>
<div class="line">27</div>
<div class="line">28</div>
<div class="line">29</div>
<div class="line">30</div>
<div class="line">31</div>
<div class="line">32</div>
<div class="line">33</div>
<div class="line">34</div>
<div class="line">35</div>
<div class="line">36</div>
<div class="line">37</div>
<div class="line">38</div>
<div class="line">39</div>
<div class="line">40</div>
<div class="line">41</div>
<div class="line">42</div>
<div class="line">43</div>
<div class="line">44</div>
<div class="line">45</div>
<div class="line">46</div>
<div class="line">47</div>
<div class="line">48</div>
<div class="line">49</div>
<div class="line">50</div>
<div class="line">51</div>
<div class="line">52</div>
<div class="line">53</div>
<div class="line">54</div>
<div class="line">55</div>
<div class="line">56</div>
<div class="line">57</div>
<div class="line">58</div>
<div class="line">59</div>
<div class="line">60</div>
<div class="line">61</div>
<div class="line">62</div>
<div class="line">63</div>
<div class="line">64</div>
<div class="line">65</div>
<div class="line">66</div>
<div class="line">67</div>
</pre></td><td class="code"><pre><div class="line"><span class="comment"># https://rahulduggal2608.wordpress.com/2017/04/02/alexnet-in-keras/</span></div>
<div class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> layers</div>
<div class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</div>
<div class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</div>
<div class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> Adam</div>
<div class="line"><span class="keyword">from</span> data_load <span class="keyword">import</span> DataLoader</div>
<div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlexNet</span><span class="params">()</span>:</span></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></div>
<div class="line">        self.height = <span class="number">227</span></div>
<div class="line">        self.width = <span class="number">227</span></div>
<div class="line">        self.channels = <span class="number">3</span></div>
<div class="line">        self.img_shape = (self.height,self.width,self.channels)</div>
<div class="line">        self.nb_classes = <span class="number">2</span></div>
<div class="line">        self.mean_flag = <span class="keyword">False</span></div>
<div class="line">        self.data_loader = DataLoader(img_res=(self.height, self.width))</div>
<div class="line">        optimizer = Adam()</div>
<div class="line"></div>
<div class="line">        self.alexnet = self.make_model()</div>
<div class="line">        self.alexnet.compile(loss=<span class="string">'categorical_crossentropy'</span>,</div>
<div class="line">                             optimizer=optimizer,</div>
<div class="line">                             metrics=[<span class="string">'accuracy'</span>])</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_model</span><span class="params">(self)</span>:</span></div>
<div class="line">        input = layers.Input(shape=self.img_shape)</div>
<div class="line">        <span class="keyword">if</span> self.mean_flag:</div>
<div class="line">            <span class="keyword">pass</span></div>
<div class="line">        x = layers.Conv2D(<span class="number">96</span>,kernel_size=<span class="number">11</span>,strides=<span class="number">4</span>,activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(input)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>,<span class="number">3</span>),strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">256</span>, kernel_size=<span class="number">5</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>), strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">384</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.Conv2D(<span class="number">384</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Conv2D(<span class="number">256</span>, kernel_size=<span class="number">3</span>, activation=<span class="string">'relu'</span>,padding=<span class="string">'same'</span>)(x)</div>
<div class="line">        x = layers.MaxPooling2D(pool_size=(<span class="number">3</span>, <span class="number">3</span>), strides=<span class="number">2</span>)(x)</div>
<div class="line">        x = layers.BatchNormalization()(x)</div>
<div class="line"></div>
<div class="line">        x = layers.Flatten()(x)</div>
<div class="line">        x = layers.Dense(<span class="number">4096</span>,activation=<span class="string">'tanh'</span>)(x)</div>
<div class="line">        x = layers.Dropout(<span class="number">0.5</span>)(x)</div>
<div class="line">        x = layers.Dense(<span class="number">4096</span>,activation=<span class="string">'tanh'</span>)(x)</div>
<div class="line">        x = layers.Dropout(<span class="number">0.5</span>)(x)</div>
<div class="line">        output = layers.Dense(self.nb_classes,activation=<span class="string">'softmax'</span>)(x)</div>
<div class="line"></div>
<div class="line">        model = Model(input,output)</div>
<div class="line">        model.summary()</div>
<div class="line">        <span class="keyword">return</span> model</div>
<div class="line"></div>
<div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self,epochs,batch_size=<span class="number">16</span>)</span>:</span></div>
<div class="line">        train_generator, validation_generator = self.data_loader.load_batch(batch_size)</div>
<div class="line"></div>
<div class="line">        self.alexnet.fit_generator(train_generator,</div>
<div class="line">                                   steps_per_epoch=<span class="number">100</span>,</div>
<div class="line">                                   epochs=epochs,</div>
<div class="line">                                   validation_data=validation_generator,</div>
<div class="line">                                   validation_steps=<span class="number">20</span>,</div>
<div class="line">                                   verbose=<span class="number">1</span>)</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div>
<div class="line">    alexnet = AlexNet()</div>
<div class="line">    alexnet.train(<span class="number">500</span>)</div>
</pre></td></tr></table></figure>
<h1 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h1><ol>
<li>Evidence shows that the best ImageNet models using convolutional and fully-connected layers typically contain between 16 and 30 layers. <a href="https://towardsdatascience.com/introduction-to-resnets-c0a830a288a4" target="_blank" rel="noopener">source</a> </li>
<li>​</li>
</ol>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Deep-Learning/" rel="tag"># Deep Learning</a>
          
            <a href="/tags/CNN/" rel="tag"># CNN</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/23/Daily-Paper-Reading/" rel="next" title="Daily Paper Reading">
                <i class="fa fa-chevron-left"></i> Daily Paper Reading
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/02/08/BroadReading/" rel="prev" title="BroadReading">
                BroadReading <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Qing Wong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">77</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">58</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#The-Architecture"><span class="nav-number">1.</span> <span class="nav-text">The Architecture</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Overfitting"><span class="nav-number">2.</span> <span class="nav-text">Overfitting</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Argmentation"><span class="nav-number">2.1.</span> <span class="nav-text">Data Argmentation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dropout"><span class="nav-number">2.2.</span> <span class="nav-text">Dropout</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Training-Details"><span class="nav-number">3.</span> <span class="nav-text">Training Details</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Results"><span class="nav-number">4.</span> <span class="nav-text">Results</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pythpn-Implementation"><span class="nav-number">5.</span> <span class="nav-text">Pythpn Implementation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Comments"><span class="nav-number">6.</span> <span class="nav-text">Comments</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qing Wong</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
